# R for travis: see documentation at https://docs.travis-ci.com/user/languages/r

sudo: required
# dist: xenial

services:
  - docker

language: minimal
cache: packages

before_install:
  - docker --version
  # - docker pull fbachl/inlabru:latest
  - docker run --name my_ubuntu -v /$(pwd):/home/work -it -d fbachl/inlabru:latest /bin/bash
  - docker ps
  - docker container ls --all
  - docker exec -it my_ubuntu ls -al /home
  - docker exec -it my_ubuntu ls -al /home/work
  - docker exec -it my_ubuntu "echo $PATH""
  - docker exec -it my_ubuntu "echo $PKG_CONFIG_PATH""
  - sudo apt-get -y install pkg-config # Not sure this is in the image
  - sudo apt-get -y install libgit2-dev libcurl4-openssl-dev libssl-dev # for git2r (devtools requirement)
  # - sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable -y
  # - sudo apt-get --yes --force-yes update -qq
  # - sudo apt-get install libgdal-dev libgeos-dev libproj-dev
  #  libudunits2-dev libv8-dev libprotobuf-dev protobuf-compiler libjq-dev

install:
  - docker exec -it my_ubuntu R -e "install.packages('devtools')"
  - docker exec -it my_ubuntu R -e "devtools::install_deps(pkg='/home/work',dep = T)"

script:
  - docker exec -it my_ubuntu R CMD build /home/work/
  - docker exec -it my_ubuntu R CMD check /home/work/*tar.gz